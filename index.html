<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Artikel mit Bild speichern - Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; background: #121417; color: #cfd2d7; padding: 20px; }
  dialog { background: #20252b; color: #cfd2d7; border-radius: 12px; padding: 20px; border: none; max-width: 400px; width: 90%; }
  label { display: block; margin-top: 12px; }
  input, textarea { width: 100%; padding: 8px; margin-top: 6px; border-radius: 6px; border: 1px solid #4a4e55; background: #2e3238; color: #cfd2d7; }
  button { margin-top: 20px; padding: 10px 20px; border: none; border-radius: 8px; background: #3a3e44; color: #cfd2d7; font-weight: bold; cursor: pointer; }
  img.preview { max-width: 100%; max-height: 200px; margin-top: 10px; border-radius: 8px; display: none; }
</style>
</head>
<body>

<button id="openDialogBtn">Artikel anlegen</button>

<dialog id="articleDialog">
  <form id="articleForm">
    <h2>Artikel mit Bild anlegen</h2>
    <label for="articleName">Name</label>
    <input id="articleName" name="articleName" type="text" required />
    <label for="imageInput">Bild ausw√§hlen</label>
    <input id="imageInput" name="image" type="file" accept="image/*" />
    <img id="preview" class="preview" alt="Bildvorschau" />
    <button type="submit">Speichern</button>
  </form>
  <button id="cancelBtn">Abbrechen</button>
</dialog>

<script>
  const dialog = document.getElementById('articleDialog');
  const form = document.getElementById('articleForm');
  const openDialogBtn = document.getElementById('openDialogBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const imageInput = document.getElementById('imageInput');
  const preview = document.getElementById('preview');

  openDialogBtn.addEventListener('click', () => {
    form.reset();
    preview.style.display = 'none';
    preview.src = '';
    dialog.showModal();
  });

  cancelBtn.addEventListener('click', () => dialog.close());

  imageInput.addEventListener('change', () => {
    if(imageInput.files && imageInput.files[0]){
      const reader = new FileReader();
      reader.onload = (e) => {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(imageInput.files[0]);
    } else {
      preview.style.display = 'none';
      preview.src = '';
    }
  });

  form.addEventListener('submit', (event) => {
    event.preventDefault();

    const file = imageInput.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = (e) => {
        saveArticle(e.target.result);
      };
      reader.readAsDataURL(file);
    } else {
      saveArticle(null);
    }
  });

  function saveArticle(imageBase64) {
    const articleName = form.articleName.value.trim();
    if(!articleName){
      alert("Bitte Name angeben.");
      return;
    }
    const articles = JSON.parse(localStorage.getItem('articles') || '[]');
    articles.push({name: articleName, image: imageBase64});
    localStorage.setItem('articles', JSON.stringify(articles));
    alert("Artikel gespeichert:\n" + articleName);
    form.reset();
    preview.style.display = 'none';
    preview.src = '';
    dialog.close();
  }
</script>

</body>
</html>
