<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Test: Artikel speichern mit Bild</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #121417; color: #cfd2d7; }
  dialog { background: #20252b; color: #cfd2d7; border-radius: 12px; padding: 20px; border: none; width: 90%; max-width: 400px; }
  label { display: block; margin-top: 12px; }
  input, textarea { width: 100%; padding: 8px; margin-top: 6px; border-radius: 6px; border: 1px solid #4a4e55; background: #2e3238; color: #cfd2d7; }
  button { margin-top: 20px; padding: 10px 20px; border: none; border-radius: 8px; background: #3a3e44; color: #cfd2d7; font-weight: bold; cursor: pointer; }
  img.preview { max-width: 100%; max-height: 200px; margin-top: 10px; border-radius: 8px; display: none; }
</style>
</head>
<body>

<button id="openBtn">Artikel anlegen</button>

<dialog id="articleDialog">
  <form id="articleForm">
    <h2>Artikel speichern</h2>
    <label for="articleName">Name</label>
    <input id="articleName" name="articleName" required />
    <label for="image">Bild ausw√§hlen</label>
    <input id="image" name="image" type="file" accept="image/*" />
    <img id="preview" class="preview" alt="Bildvorschau" />
    <button type="submit">Speichern</button>
  </form>
  <button id="cancelBtn">Abbrechen</button>
</dialog>

<script>
  const dialog = document.getElementById('articleDialog');
  const form = document.getElementById('articleForm');
  const openBtn = document.getElementById('openBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const imageInput = document.getElementById('image');
  const preview = document.getElementById('preview');

  openBtn.addEventListener('click', () => dialog.showModal());
  cancelBtn.addEventListener('click', () => dialog.close());

  imageInput.addEventListener('change', () => {
    if (imageInput.files && imageInput.files[0]) {
      const reader = new FileReader();
      reader.onload = e => {
        preview.src = e.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(imageInput.files[0]);
    } else {
      preview.src = "";
      preview.style.display = "none";
    }
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    const file = imageInput.files[0];
    function saveImage(base64) {
      const articleName = form.articleName.value.trim();
      const articles = JSON.parse(localStorage.getItem('articles') || '[]');
      articles.push({ name: articleName, image: base64 || null });
      localStorage.setItem('articles', JSON.stringify(articles));
      alert(`Artikel '${articleName}' gespeichert!`);
      form.reset();
      preview.style.display = "none";
      dialog.close();
    }

    if (file) {
      const reader = new FileReader();
      reader.onload = e => saveImage(e.target.result);
      reader.readAsDataURL(file);
    } else {
      saveImage(null);
    }
  });
</script>

</body>
</html>
